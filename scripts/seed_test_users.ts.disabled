/**
 * Seed Test Users Script
 * 
 * Creates 3 test users for role switching:
 * - maria.cliente@test.com (client)
 * - carlos.proveedor@test.com (provider)
 * - admin@test.com (admin)
 * 
 * Password for all: test123456
 */

import { db } from '@/lib/db';
import { users } from '@/lib/db/schema';
import { eq } from 'drizzle-orm';

const TEST_USERS = [
    {
        email: 'maria.cliente@test.com',
        name: 'MarÃ­a Cliente',
        role: 'user' as const,
        bio: 'Necesito remodelar mi cocina y baÃ±o. Busco profesionales confiables.',
        location: 'Buenos Aires, Argentina',
        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=maria',
    },
    {
        email: 'carlos.proveedor@test.com',
        name: 'Carlos Proveedor',
        role: 'user' as const,
        bio: 'Maestro mayor de obras con 15 aÃ±os de experiencia. Especializado en remodelaciones.',
        location: 'Buenos Aires, Argentina',
        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=carlos',
        skills: ['ConstrucciÃ³n', 'PlomerÃ­a', 'Electricidad', 'Pintura'],
    },
    {
        email: 'admin@test.com',
        name: 'Admin Sistema',
        role: 'admin' as const,
        bio: 'Administrador de la plataforma',
        location: 'Buenos Aires, Argentina',
        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=admin',
    },
];

async function seedTestUsers() {
    console.log('ðŸŒ± Seeding test users...\n');

    for (const userData of TEST_USERS) {
        try {
            // Check if user exists
            const [existing] = await db
                .select()
                .from(users)
                .where(eq(users.email, userData.email))
                .limit(1);

            if (existing) {
                console.log(`âœ“ User already exists: ${userData.email}`);
                console.log(`  ID: ${existing.id}`);
                console.log(`  Role: ${existing.role}\n`);
                continue;
            }

            // Create user
            const [newUser] = await db
                .insert(users)
                .values({
                    email: userData.email,
                    name: userData.name,
                    role: userData.role,
                    bio: userData.bio,
                    location: userData.location,
                    profileImageUrl: userData.avatar,
                    emailVerified: true,
                    onboardingCompleted: true,
                })
                .returning();

            console.log(`âœ“ Created user: ${userData.email}`);
            console.log(`  ID: ${newUser.id}`);
            console.log(`  Name: ${newUser.name}`);
            console.log(`  Role: ${newUser.role}\n`);
        } catch (error) {
            console.error(`âœ— Error creating user ${userData.email}:`, error);
        }
    }

    console.log('\nðŸŽ‰ Test users seeded successfully!\n');
    console.log('ðŸ“ Next steps:');
    console.log('1. Create Supabase auth users with these emails');
    console.log('2. Password for all: test123456');
    console.log('3. Or use the Role Switcher as admin\n');
    console.log('ðŸ”— Access testing page: http://localhost:3000/es/admin/testing\n');
}

seedTestUsers()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error('Fatal error:', error);
        process.exit(1);
    });
